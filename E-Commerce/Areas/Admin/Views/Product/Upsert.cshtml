@model ProductVM

@{
	ViewData["Title"] = "Product";
}

<style>
	.image-slide {
		transition: transform 0.3s ease, box-shadow 0.3s ease;
	}

	.image-track-container {
		cursor: grab;
	}

		.image-track-container:active {
			cursor: grabbing;
		}

	.image-track {
		transition: transform 0.5s cubic-bezier(0.22, 1, 0.36, 1);
	}

	.image {
		transition: object-position 0.5s cubic-bezier(0.22, 1, 0.36, 1);
	}

</style>

<div class="container mx-auto p-4">
	<div class="flex justify-between items-center pb-4">
		<h2 class="text-2xl font-bold text-indigo-600">@((Model.product.Id > 0 ? "Update " : "Create ") + ViewData["Title"])</h2>
	</div>
</div>


<form method="post" enctype="multipart/form-data" class="space-y-6">
	<input type="hidden" asp-for="product.Id" />
	@* <input type="hidden" asp-for="product.ImageURL" /> *@

	<div class="bg-white border border-slate-200 rounded-md p-6 space-y-6">
		<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
			<div>
				<label asp-for="product.Title" class="block text-gray-700 font-medium"></label>
				<input asp-for="product.Title" class="w-full p-3 border rounded-md focus:ring-1 focus:ring-blue-500 outline-none shadow-sm transition duration-300 ease-in-out hover:border-blue-500" type="text" />
				<span class="text-red-500 text-sm" asp-validation-for="product.Title"></span>
			</div>
			<div>
				<label asp-for="product.Category_ID" class="block text-gray-700 font-medium"></label>
				<select asp-for="product.Category_ID" asp-items="@Model.categoryList" class="w-full p-3 border rounded-md focus:ring-1 focus:ring-blue-500 outline-none shadow-sm transition duration-300 ease-in-out hover:border-blue-500">
					<option disabled selected>Select Category</option>
				</select>
				<span class="text-red-500 text-sm" asp-validation-for="product.Category_ID"></span>
			</div>
		</div>

		<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
			<div>
				<label asp-for="product.Author" class="block text-gray-700 font-medium"></label>
				<input asp-for="product.Author" class="w-full p-3 border rounded-md focus:ring-1 focus:ring-blue-500 outline-none shadow-sm transition duration-300 ease-in-out hover:border-blue-500" type="text" />
				<span class="text-red-500 text-sm" asp-validation-for="product.Author"></span>
			</div>
			<div>
				<label asp-for="product.ISBN" class="block text-gray-700 font-medium"></label>
				<input asp-for="product.ISBN" class="w-full p-3 border rounded-md focus:ring-1 focus:ring-blue-500 outline-none shadow-sm transition duration-300 ease-in-out hover:border-blue-500" type="text" />
				<span class="text-red-500 text-sm" asp-validation-for="product.ISBN"></span>
			</div>
		</div>

		<div class="flex items-center space-x-4">
			<!-- File Upload -->
			<div class="flex-1">
				<input asp-for="product.ProductImages"
					   type="file"
					   multiple
					   name="files"
					   accept="image/*" />
			</div>

			<!-- Image Preview -->
			@if (Model.product.ProductImages?.Count() is not null && Model.product.ProductImages.Count > 0)
			{
				<div class="relative max-w-5xl mx-auto px-10 py-1 mb-5">
					<div class="image-track-container group relative overflow-hidden h-[200px] w-[800px] rounded-lg">
						<div class="image-track absolute top-1/2 left-0 flex gap-4 -translate-y-1/2" data-mouse-down-at="0" data-prev-percentage="0">
							@foreach (var ProductImage in Model.product.ProductImages)
							{
								<div class="image-slide relative h-[200px] w-[150px] overflow-hidden rounded-lg border-2 border-white bg-white transition-all duration-300 group/image">
									<!-- Three-dot menu -->
									<div class="absolute top-1 right-1 group/menu">
										<button class="bg-white/60 rounded-full p-1 hover:bg-white/80 transition-all duration-300 flex items-center justify-center w-6 h-6">
											<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
												<path stroke-linecap="round" stroke-linejoin="round" d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
											</svg>
										</button>
										<!-- Dropdown menu -->
										<div class="absolute right-0 top-full mt-1 w-32 bg-white rounded-md shadow-lg py-1 z-20 opacity-0 invisible group-hover/menu:opacity-100 group-hover/menu:visible transition-all duration-200">
											<a href="@ProductImage.ImageURL" download class="flex items-center px-3 py-1.5 text-xs text-gray-700 hover:bg-gray-100">
												<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2">
													<path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
												</svg>
												Download
											</a>
											<a href="@ProductImage.ImageURL" target="_blank" class="flex items-center px-3 py-1.5 text-xs text-gray-700 hover:bg-gray-100">
												<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2">
													<path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
													<path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
												</svg>
												View
											</a>
											<a asp-action="DeleteImage" asp-route-ImageID="@ProductImage.ID" class="flex items-center px-3 py-1.5 text-xs text-red-600 hover:bg-gray-100">
												<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2">
													<path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
												</svg>
												Delete
											</a>
										</div>
									</div>

									<img src="@ProductImage.ImageURL" alt="Product image" class="image h-[200px] w-[150px] object-cover transition-transform duration-500" style="object-position: 100% center;" />
								</div>
							}
						</div>

						<!-- Navigation buttons -->
						<button id="prev-button" class="absolute left-0 top-1/2 z-10 flex h-10 w-10 -translate-y-1/2 items-center justify-center rounded-full bg-white/80 text-gray-800 border shadow-sm transition-all hover:shadow-md hover:bg-primary hover:text-indigo-500 group-hover:opacity-100 md:opacity-0">
							<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
								<path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
							</svg>
						</button>
						<button id="next-button" class="absolute right-0 top-1/2 z-10 flex h-10 w-10 -translate-y-1/2 items-center justify-center rounded-full bg-white/80 text-gray-800 border shadow-sm transition-all hover:shadow-md hover:bg-primary hover:text-indigo-500 group-hover:opacity-100 md:opacity-0">
							<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
								<path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
							</svg>
						</button>
					</div>

					<div class="absolute -bottom-5 left-0 right-0 -bottom-5 flex justify-center gap-2">
						<span class="text-sm text-gray-500">Drag to explore more images</span>
					</div>
				</div>
			}
		</div>


		<div class="grid grid-cols-1 md:grid-cols-4 gap-4">
			<div>
				<label asp-for="product.ListPrice" class="block text-gray-700 font-medium"></label>
				<input asp-for="product.ListPrice" class="w-full p-3 border rounded-md focus:ring-1 focus:ring-blue-500 outline-none shadow-sm transition duration-300 ease-in-out hover:border-blue-500" type="text" />
				<span class="text-red-500 text-sm" asp-validation-for="product.ListPrice"></span>
			</div>
			<div>
				<label asp-for="product.Price" class="block text-gray-700 font-medium"></label>
				<input asp-for="product.Price" class="w-full p-3 border rounded-md focus:ring-1 focus:ring-blue-500 outline-none shadow-sm transition duration-300 ease-in-out hover:border-blue-500" type="text" />
				<span class="text-red-500 text-sm" asp-validation-for="product.Price"></span>
			</div>
			<div>
				<label asp-for="product.Price50" class="block text-gray-700 font-medium"></label>
				<input asp-for="product.Price50" class="w-full p-3 border rounded-md focus:ring-1 focus:ring-blue-500 outline-none shadow-sm transition duration-300 ease-in-out hover:border-blue-500" type="text" />
				<span class="text-red-500 text-sm" asp-validation-for="product.Price50"></span>
			</div>
			<div>
				<label asp-for="product.Price100" class="block text-gray-700 font-medium"></label>
				<input asp-for="product.Price100" class="w-full p-3 border rounded-md focus:ring-1 focus:ring-blue-500 outline-none shadow-sm transition duration-300 ease-in-out hover:border-blue-500" type="text" />
				<span class="text-red-500 text-sm" asp-validation-for="product.Price100"></span>
			</div>
		</div>

		<div>
			<label asp-for="product.Description" class="block text-gray-700 font-medium"></label>
			<textarea asp-for="product.Description" rows="6" class="w-full p-3 border rounded-md focus:ring-1 focus:ring-blue-500 outline-none shadow-sm transition duration-300 ease-in-out hover:border-blue-500"></textarea>
			<span class="text-red-500 text-sm" asp-validation-for="product.Description"></span>
		</div>

		<div class="flex justify-between items-center">
			<a asp-controller="Product" asp-action="Index" class="text-gray-600 hover:text-blue-500 font-medium flex items-center">
				<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-1">
					<path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
				</svg>
				Back to List
			</a>
			<div class="space-x-2 flex justify-end">
				@if (Model.product.Id == 0)
				{
					<button type="reset" class="btn-primary-outline">Clear</button>
					<button type="submit" class="btn-indigo">Create</button>
				}
				else
				{
					<button type="submit" class="btn-indigo">Update</button>
				}
			</div>
		</div>
	</div>
</form>


<script src="https://cdn.tiny.cloud/1/f0r85f4ubu7hkygrjjeg5r70sspl7k6y9u8bthskwy0ji4g5/tinymce/7/tinymce.min.js" referrerpolicy="origin"></script>
<script src="~/js/ImageSlider.js" type="text/javascript" defer></script>
<link href="~/css/ImageSlider.css" />

<script>

	document.addEventListener("DOMContentLoaded", function() {
		sliderInit();

		document.querySelectorAll('.file-upload-component').forEach(container => {
			// Store instance reference on the container
			container.fileUploadInstance = new FileUpload(container);
		});


		document.querySelector('form').addEventListener('submit', function(e) {
			// Ensure all files are properly attached
			document.querySelectorAll('.file-upload-component').forEach(component => {
				const fileUpload = component.fileUploadInstance;
				if (fileUpload) {
					fileUpload.updateFileInput();
				}
			});
		});



	});


	tinymce.init({
	  selector: 'textarea',
	  skin: 'oxide',
	  toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table mergetags | addcomment showcomments | spellcheckdialog a11ycheck typography | align lineheight | checklist numlist bullist indent outdent | emoticons charmap | removeformat',
	  plugins: [
		'advlist', 'autolink', 'lists', 'link', 'charmap', 'preview',
		'searchreplace', 'visualblocks', 'fullscreen',
		'insertdatetime', 'media', 'table', 'code'
	  ],
	  height: 250,
			  setup: function (editor) {
		editor.on('init', function () {
			document.querySelector('.tox.tox-tinymce').style.zIndex = '10';
		});
	}
	});

</script>

@section Scripts {

	@{
		<partial name="_ValidationScriptsPartial" />
	}
}
