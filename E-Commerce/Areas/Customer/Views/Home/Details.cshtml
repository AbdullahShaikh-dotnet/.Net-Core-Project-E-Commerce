@model ShoppingCart

@{
    ViewData["Title"] = Model.product.Title;
}

<style>
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    input[type="number"] {
        -moz-appearance: textfield;
    }
</style>

<form method="post" class="max-w-5xl mx-auto px-4 py-8">
    <input asp-for="ProductID" type="hidden" />

    <!-- Back to Home -->
    <div class="mb-6">
        <a asp-action="Index" class="text-gray-500 hover:text-gray-700 font-medium inline-flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
            </svg>
            Back to Home
        </a>
    </div>

    <!-- Product Container -->
    <div class="bg-white rounded-lg overflow-hidden border border-gray-100">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 p-6">
            <!-- Product Images -->
            <div class="space-y-4">
                <!-- Main Image -->
                <div class="aspect-square rounded-md overflow-hidden bg-gray-50">
                    <img id="mainImage" src="@(Model.product.ProductImages != null && Model.product.ProductImages.Any() ? Model.product.ProductImages.First().ImageURL : "#")"
                         alt="@Model.product.Title"
                         class="w-full h-full object-cover" />
                </div>

                <!-- Image Thumbnails -->
                @if (Model.product.ProductImages != null && Model.product.ProductImages.Count() > 1)
                {
                    <div class="flex space-x-2 overflow-x-auto pb-2">
                        @foreach (var image in Model.product.ProductImages)
                        {
                            <button type="button"
                                    onclick="changeMainImage('@image.ImageURL.Replace("\\","/")')"
                                    class="w-16 h-16 rounded-md overflow-hidden flex-shrink-0 border-2 border-transparent hover:border-gray-300 focus:border-blue-500 focus:outline-none transition">
                                <img src="@image.ImageURL" alt="@Model.product.Title" class="w-full h-full object-cover" />
                            </button>
                        }
                    </div>
                }
            </div>

            <!-- Product Details -->
            <div class="flex flex-col space-y-5">
                <!-- Category Badge -->
                <div>
                    <span class="inline-block text-xs font-medium bg-gray-100 text-gray-700 px-2.5 py-1 rounded-full">
                        @Model.product.Category.Name
                    </span>
                </div>

                <!-- Title & Author -->
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">@Model.product.Title</h1>
                    <p class="text-gray-500 text-sm">by @Model.product.Author</p>
                </div>

                <!-- Product Info -->
                <div class="text-sm text-gray-500">
                    <p>ISBN: 1234567890</p>
                    <p class="mt-1">
                        List Price: <span class="line-through">@Model.product.ListPrice.ToString("C")</span>
                    </p>
                </div>

                <!-- Pricing Table -->
                <div class="border border-gray-100 rounded-md overflow-hidden">
                    <div class="grid grid-cols-4 bg-gray-50 text-xs font-medium text-gray-600">
                        <div class="p-2 text-center">Quantity</div>
                        <div class="p-2 text-center">1-50</div>
                        <div class="p-2 text-center">51-100</div>
                        <div class="p-2 text-center">100+</div>
                    </div>
                    <div class="grid grid-cols-4 text-center text-sm font-semibold text-gray-800">
                        <div class="p-2 border-t border-gray-100">Price</div>
                        <div class="p-2 border-t border-gray-100">@Model.product.Price.ToString("C")</div>
                        <div class="p-2 border-t border-gray-100">@Model.product.Price50.ToString("C")</div>
                        <div class="p-2 border-t border-gray-100">@Model.product.Price100.ToString("C")</div>
                    </div>
                </div>

                <!-- Quantity Selector -->
                <div class="flex items-center space-x-3">
                    <label for="Count" class="text-sm font-medium text-gray-700">Quantity</label>
                    <div class="flex items-center border border-gray-200 rounded-md">
                        <button type="button"
                                class="w-8 h-8 flex items-center justify-center text-gray-500 hover:bg-gray-50"
                                onclick="updateQuantity(-1)">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12h-15" />
                            </svg>
                        </button>
                        <input asp-for="Count"
                               type="number"
                               value="1"
                               class="w-12 h-8 text-center text-sm border-0 focus:ring-0 focus:outline-none"
                               id="quantityInput"
                               min="1"
                               max="150"
                               oninput="validateQuantity(this)">
                        <button type="button"
                                class="w-8 h-8 flex items-center justify-center text-gray-500 hover:bg-gray-50"
                                onclick="updateQuantity(1)">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="pt-5 mt-2 border-t border-gray-100 flex flex-col sm:flex-row gap-3">
                    <button type="submit"
                            class="w-full sm:w-1/2 bg-gray-800 text-white py-2.5 px-4 rounded-md text-sm font-medium hover:bg-gray-700 transition focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 inline-block mr-1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 0 0-16.536-1.84M7.5 14.25 5.106 5.272M6 20.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12.75 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
                        </svg>
                        Add to Cart
                    </button>
                    <button type="submit"
                            class="w-full sm:w-1/2 bg-white border border-gray-200 text-gray-800 py-2.5 px-4 rounded-md text-sm font-medium hover:bg-gray-50 transition focus:outline-none focus:ring-2 focus:ring-gray-200 focus:ring-offset-2">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 inline-block mr-1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6Z" />
                        </svg>
                        Buy Now
                    </button>
                </div>
            </div>
        </div>

        <!-- Description -->
        @if (!string.IsNullOrEmpty(Model.product.Description))
        {
            <div class="p-6 border-t border-gray-100">
                <h2 class="text-sm font-medium text-gray-700 mb-3">Description</h2>
                <div class="prose prose-sm max-w-none text-gray-600">
                    @Html.Raw(Model.product.Description)
                </div>
            </div>
        }
    </div>
</form>

<script>
    function updateQuantity(change) {
        const quantityInput = document.getElementById('quantityInput');
        let currentValue = parseInt(quantityInput.value, 10);

        currentValue += change;

        if (currentValue < 1) {
            currentValue = 1;
        } else if (currentValue > 150) {
            currentValue = 150;
        }

        quantityInput.value = currentValue;
    }

    function validateQuantity(input) {
        let value = parseInt(input.value, 10);

        if (isNaN(value)) {
            input.value = 1;
            return;
        }

        if (value < 1) {
            input.value = 1;
        } else if (value > 150) {
            input.value = 150;
        }
    }

    function changeMainImage(imageUrl) {
        document.getElementById('mainImage').src = imageUrl;
    }
</script>