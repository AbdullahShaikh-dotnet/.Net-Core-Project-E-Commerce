@page
@model EnableAuthenticatorModel
@{
    ViewData["Title"] = "Configure Authenticator App";
    ViewData["ActivePage"] = ManageNavPages.TwoFactorAuthentication;
}

<partial name="_StatusMessage" for="StatusMessage" />

<div class="max-w-3xl mx-auto bg-white p-6 rounded-2xl shadow-md border border-gray-200">
    <h3 class="text-3xl font-bold text-gray-900 mb-4 flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 mr-3">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" />
        </svg>
        @ViewData["Title"]
    </h3>

    <p class="text-gray-700 mb-4">Follow these steps to set up your authenticator app:</p>

    <ol class="list-decimal pl-6 space-y-4 text-gray-700">
        <li>
            <p>
                Download an authenticator app like **Microsoft Authenticator** for
                <a href="https://go.microsoft.com/fwlink/?Linkid=825072" class="text-blue-600 font-semibold">Android</a> and
                <a href="https://go.microsoft.com/fwlink/?Linkid=825073" class="text-blue-600 font-semibold">iOS</a>
                or **Google Authenticator** for
                <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&amp;hl=en" class="text-blue-600 font-semibold">Android</a> and
                <a href="https://itunes.apple.com/us/app/google-authenticator/id388497605?mt=8" class="text-blue-600 font-semibold">iOS</a>.
            </p>
        </li>

        <li>
            <p>
                Scan the **QR Code** or enter this key:
                <kbd class="px-2 py-1 bg-gray-100 border rounded-md text-lg">@Model.SharedKey</kbd>
                into your authenticator app. **Spaces and casing do not matter.**
            </p>
            <div id="qrCode" class="flex justify-center p-4 border rounded-md shadow-sm bg-gray-50">
                <div id="qrCodeData" data-url="@Model.AuthenticatorUri"></div>
            </div>
        </li>

        <li>
            <p>
                After scanning the QR code or entering the key, your **authenticator app** will generate a **6-digit code**.
                Enter the code below to verify.
            </p>

            <form id="send-code" method="post" class="mt-4">
                <div class="mb-4">
                    <label asp-for="Input.Code" class="block text-sm font-medium text-gray-700 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 mr-2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z" />
                        </svg>
                        Verification Code
                    </label>
                    <input asp-for="Input.Code" class="w-full px-4 py-2 border rounded-lg shadow-sm focus:ring focus:ring-blue-300" autocomplete="off" placeholder="Enter your verification code" />
                    <span asp-validation-for="Input.Code" class="text-red-600 text-sm"></span>
                </div>

                <button type="submit" class="w-full flex items-center justify-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    Verify Code
                </button>

                <div asp-validation-summary="ModelOnly" class="text-red-600 mt-2" role="alert"></div>
            </form>
        </li>
    </ol>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}

<script src="~/js/qrcode.min.js"></script>

<script>
        window.addEventListener("load", () => {
      const uri = document.getElementById("qrCodeData").getAttribute('data-url');
      new QRCode(document.getElementById("qrCode"),
        {
          text: uri,
          width: 150,
          height: 150
        });
    });
</script>
