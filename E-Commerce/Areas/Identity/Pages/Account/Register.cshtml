@page
@using ECom.Utility
@model RegisterModel
@{
    ViewData["Title"] = "Register";
    bool isAdmin = User.IsInRole(SD.Role_Admin);
}

<div class="flex justify-center items-center min-h-screen">
    <div class="w-full max-w-2xl bg-white p-6 rounded-lg shadow-md border border-gray-200">
        <h1 class="text-3xl font-bold text-center text-gray-900">@ViewData["Title"] @(isAdmin ? "Admin Portal" : "")</h1>

        <form id="registerForm" asp-route-returnUrl="@Model.ReturnUrl" method="post" class="mt-6 space-y-4">
            <div asp-validation-summary="ModelOnly" class="text-red-600 text-sm bg-red-100 p-2 rounded-md" role="alert"></div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label asp-for="Input.Email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input asp-for="Input.Email" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring focus:ring-blue-300 outline-none" placeholder="name@example.com" />
                    <span asp-validation-for="Input.Email" class="text-red-500 text-sm"></span>
                </div>

                <div>
                    <label asp-for="Input.Name" class="block text-sm font-medium text-gray-700">Name</label>
                    <input asp-for="Input.Name" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring focus:ring-blue-300 outline-none" placeholder="Your Name" />
                    <span asp-validation-for="Input.Name" class="text-red-500 text-sm"></span>
                </div>

                <div>
                    <label asp-for="Input.Password" class="block text-sm font-medium text-gray-700">Password</label>
                    <input asp-for="Input.Password" type="password" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring focus:ring-blue-300 outline-none" placeholder="Password" />
                    <span asp-validation-for="Input.Password" class="text-red-500 text-sm"></span>
                </div>

                <div>
                    <label asp-for="Input.ConfirmPassword" class="block text-sm font-medium text-gray-700">Confirm Password</label>
                    <input asp-for="Input.ConfirmPassword" type="password" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring focus:ring-blue-300 outline-none" placeholder="Confirm Password" />
                    <span asp-validation-for="Input.ConfirmPassword" class="text-red-500 text-sm"></span>
                </div>

                <div>
                    <label asp-for="Input.StreetAddress" class="block text-sm font-medium text-gray-700">Street Address</label>
                    <input asp-for="Input.StreetAddress" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring focus:ring-blue-300 outline-none" placeholder="Address" />
                    <span asp-validation-for="Input.StreetAddress" class="text-red-500 text-sm"></span>
                </div>

                <div>
                    <label asp-for="Input.City" class="block text-sm font-medium text-gray-700">City</label>
                    <input asp-for="Input.City" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring focus:ring-blue-300 outline-none" placeholder="City" />
                    <span asp-validation-for="Input.City" class="text-red-500 text-sm"></span>
                </div>

                <div>
                    <label asp-for="Input.State" class="block text-sm font-medium text-gray-700">State</label>
                    <input asp-for="Input.State" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring focus:ring-blue-300 outline-none" placeholder="State" />
                    <span asp-validation-for="Input.State" class="text-red-500 text-sm"></span>
                </div>

                <div>
                    <label asp-for="Input.PostalCode" class="block text-sm font-medium text-gray-700">Postal Code</label>
                    <input asp-for="Input.PostalCode" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring focus:ring-blue-300 outline-none" placeholder="Postal Code" />
                    <span asp-validation-for="Input.PostalCode" class="text-red-500 text-sm"></span>
                </div>

                <div>
                    <label asp-for="Input.PhoneNumber" class="block text-sm font-medium text-gray-700">Phone Number</label>
                    <input asp-for="Input.PhoneNumber" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring focus:ring-blue-300 outline-none" placeholder="Phone Number" />
                    <span asp-validation-for="Input.PhoneNumber" class="text-red-500 text-sm"></span>
                </div>
            </div>

            @if (isAdmin)
            {
                <div>
                    <label asp-for="Input.Role" class="block text-sm font-medium text-gray-700">Role</label>
                    <select id="selectRole" asp-for="Input.Role" asp-items="@Model.Input.RoleList" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring focus:ring-blue-300 outline-none">
                        <option disabled selected>Select Role</option>
                    </select>
                </div>

                <div id="companySelection" class="hidden">
                    <label asp-for="Input.CompanyID" class="block text-sm font-medium text-gray-700">Company</label>
                    <select id="selectCompany" asp-for="Input.CompanyID" asp-items="@Model.Input.CompanyList" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring focus:ring-blue-300 outline-none">
                        <option disabled selected>Select Company</option>
                    </select>
                </div>
            }

            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg shadow-md transition">
                Register
            </button>

            @if (!isAdmin)
            {
                <div class="text-center text-sm mt-3">
                    <a asp-area="Identity" asp-controller="Account" asp-action="Login" class="text-blue-600">Already have an account? Login</a>
                </div>
            }
        </form>

        @if (!isAdmin)
        {
            <div class="flex items-center mt-4">
                <div class="flex-grow border-t"></div>
                <span class="mx-3 text-gray-500">OR</span>
                <div class="flex-grow border-t"></div>
            </div>

            <div class="mt-4">
                @if ((Model.ExternalLogins?.Count ?? 0) > 0)
                {
                    <form id="external-account" asp-page="./ExternalLogin" asp-route-returnUrl="@Model.ReturnUrl" method="post">
                        <div class="flex space-x-2">
                            @foreach (var provider in Model.ExternalLogins!)
                            {
                                <button type="submit" name="provider" value="@provider.Name"
                                        class="flex-1 flex items-center justify-center gap-2 py-3 rounded-lg shadow-md font-medium transition
                                @(provider.Name == "Google" ? "bg-rose-600 hover:bg-rose-700 text-white" : "bg-blue-600 hover:bg-blue-700 text-white")">

                                    @if (provider.Name == "Google")
                                    {
                                        <svg xmlns="http://www.w3.org/2000/svg" class="text-white" fill="white" x="0px" y="0px" width="20" height="20" viewBox="0 0 30 30">
                                            <path d="M 15.003906 3 C 8.3749062 3 3 8.373 3 15 C 3 21.627 8.3749062 27 15.003906 27 C 25.013906 27 27.269078 17.707 26.330078 13 L 25 13 L 22.732422 13 L 15 13 L 15 17 L 22.738281 17 C 21.848702 20.448251 18.725955 23 15 23 C 10.582 23 7 19.418 7 15 C 7 10.582 10.582 7 15 7 C 17.009 7 18.839141 7.74575 20.244141 8.96875 L 23.085938 6.1289062 C 20.951937 4.1849063 18.116906 3 15.003906 3 z"></path>
                                        </svg>
                                    }
                                    else
                                    {
                                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M22 12c0-5.5-4.5-10-10-10S2 6.5 2 12c0 4.6 3.2 8.4 7.5 9.6v-6.7H7.1v-2.9h2.4V9.6c0-2.4 1.4-3.7 3.5-3.7.7 0 1.5.1 2.2.2v2.4h-1.5c-1.2 0-1.6.7-1.6 1.5v1.8h2.9l-.5 2.9h-2.4v6.7C18.8 20.4 22 16.6 22 12z" />
                                        </svg>
                                    }

                                    Login with @provider.DisplayName
                                </button>
                            }
                        </div>
                    </form>
                }
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const RoleDropdown = document.getElementById('selectRole');
            const CompanyDropdown = document.getElementById('companySelection');
            RoleDropdown.addEventListener('change', function() {
                CompanyDropdown.classList.toggle('hidden', this.value !== 'Company');
            });
        });
    </script>
    <partial name="_ValidationScriptsPartial" />
}
